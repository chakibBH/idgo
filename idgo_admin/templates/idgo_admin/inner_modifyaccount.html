{% load bootstrap3 %}

{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'success' %}
            <div class="alert alert-success" role="alert">{{ message | escape | safe }}</div>
        {% elif message.tags == 'error' %}
            <div class="alert alert-danger" role="alert">{{ message | escape | safe }}</div>
        {% endif %}
    {% endfor %}
{% endif %}

<h2 class="modal-title">Mes informations personnelles</h2>
<br/>
<form method="post" action="" enctype="multipart/form-data">
	{% csrf_token %}
	<div class="row">
		<div class="col-xs-6">
			{% bootstrap_field uform.username %}
		</div>
	</div>
	<div class="row">
		<div class="col-xs-4">
			{% bootstrap_field uform.first_name %}
		</div>
		<div class="col-xs-4">
			{% bootstrap_field uform.last_name %}
		</div>
	</div>
	<div class="row">
		<div class="col-xs-6">
			{% bootstrap_field uform.email %}
		</div>
		<div class="col-xs-2">
			{% bootstrap_field pform.phone %}
		</div>
	</div>
	<p>Entrez un nouveau mot de passe ci-dessous si vous souhaitez le modifier. <br />Sinon, laissez les champs vides.</p>
	<div class="row">
		<div class="col-xs-4 col-sm-4">
			{% bootstrap_field uform.password1 show_label=False %}
		</div>
	</div>
	<div class="row">
		<div class="col-xs-4 col-sm-4">
			{% bootstrap_field uform.password2 show_label=False %}
		</div>
	</div>
	<hr />
	{% if pform.organisation.field.widget.is_hidden == False %}
	<div id="collapse-one" class="collapse in">
		<p>Sélectionnez dans la liste ci-dessous l'organisme auquel vous êtes rattaché</p>
		<div class="row">
			<div class="col-xs-9">
				{% bootstrap_field pform.organisation show_label=False %}
			</div>
		</div>
		{% bootstrap_field pform.is_new_orga %}
		<p>Si celui-ci n'est pas dans la liste, vous pouvez <a id="add-organization" type="button">indiquer un nouvel organisme</a>. </p>
	</div>
	<div id="collapse-two" class="collapse">
		<div class="well">
			<button type="button" class="close" data-dismiss="alert" aria-label="Close">
				<span aria-hidden="true">&times;</span>
			</button>
			<p>Veuillez indiquer ci-dessous le nom et l'URL du site internet de l'organisme auquel vous êtes rattaché. </p>
			<p>Une demande de création d'organisme est soumise à l'administrateur du site pour validation. </p>
			<div class="row">
				<div class="col-xs-12 col-sm-8">
					{% bootstrap_field pform.logo %}
				</div>
				<div class="col-xs-12 col-sm-8">
					{% bootstrap_field pform.new_orga show_label=False %}
				</div>
				<div class="col-xs-12 col-sm-4">
					{% bootstrap_field pform.code_insee show_label=False %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.adresse show_label=False %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12 col-sm-3">
					{% bootstrap_field pform.code_postal show_label=False %}
				</div>
				<div class="col-xs-12 col-sm-9">
					{% bootstrap_field pform.ville show_label=False %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.org_phone show_label=False %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.new_website show_label=False %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.description show_label=False %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.organisation_type %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.financeur %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.status %}
				</div>
			</div>
			<div class="row">
				<div class="col-xs-12">
					{% bootstrap_field pform.license %}
				</div>
			</div>
			<!-- <div class="row">#}
				<div class="col-xs-12">
					{# {% bootstrap_field pform.referent_requested show_label=False %} #}
				</div>
			</div> -->
		</div>
	</div>
	{% bootstrap_field pform.contribution_requested show_label=False %}
	{% else %}
	<div class="alert alert-info"><a href="{% url "idgo_admin:contributions" %}">En attente de rattachement</a></div>
	{% endif %}
	<hr />
	<div class="row">
		<div class="col-xs-9">
			{% bootstrap_field pform.role %}
		</div>
	</div>
	<div class="buttons-on-the-right-side">
		<a class="btn btn-default" href="{% url "idgo_admin:home" %}">Annuler</a>
		<button type="submit" class="btn btn-default">Valider les changements</button>
	</div>
</form>
<script>
var $contributionRequested = $('input[name="contribution_requested"]').parent();
$('select[name="organisation"]').change(function() {
	if (this.value) {
		$contributionRequested.show();
	} else {
		$contributionRequested.hide();
	};
});

var $collapseOne = $('#collapse-one')
	.collapse({
		toggle: false
	})
	.on('hidden.bs.collapse', function() {
		$('#collapse-one select').each(function(i) {
			// $(this)[0].selectedIndex = 0;
			$contributionRequested.show();
		});
	});
var $collapseTwo = $('#collapse-two')
	.collapse({
		toggle: false
	})
	.on('hidden.bs.collapse', function() {
		$('#collapse-two input').each(function(i) {
			$(this).val('');
			$contributionRequested.hide();
		});
	});

function tggl() {
	$collapseOne.collapse('toggle');
	$collapseTwo.collapse('toggle');
};

$('#add-organization').click(tggl);
$('#collapse-two .close').click(tggl);

$contributionRequested.hide();
{% if pform.new_orga.value %} tggl(); {% endif %}

</script>
